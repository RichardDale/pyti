from __future__ import absolute_import
import unittest
import numpy as np

from tests.sample_data import SampleData
from pyti import williams_percent_r


class TestWilliamsPercentR(unittest.TestCase):
    def setUp(self):
        """Create data to use for testing."""
        self.high_data = SampleData().get_sample_high_data()
        self.low_data = SampleData().get_sample_low_data()
        self.close_data = SampleData().get_sample_close_data()

        self.wpr_expected = [
            np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan, np.nan,
            np.nan, np.nan, np.nan, np.nan, -41.351174934725954, -55.186104218362054,
            -91.39978409499827, -90.93750000000007, -95.17581475128647,
            -90.80188679245268, -96.55825159180864, -95.7276595744681,
            -76.06808510638307, -52.98723404255318, -59.200000000000145,
            -68.71489361702129, -69.5767664246503, -54.11718131433104,
            -54.5130641330168, -60.59593428014483, -24.76043276661519,
            -39.94708994708984, -55.88624338624351, -93.99806389157787,
            -49.152952565343604, -28.484995159728946, -4.442508710801317,
            -3.6045962537383356, -19.26648827325675, -52.21155359672591,
            -50.49582874232637, -40.68943806075875, -13.835983000157354,
            -6.878640012592486, -3.342696629213634, -6.446629213483186,
            -3.030303030303054, -3.9838056680162532, -3.6058491193086755,
            -23.17215994646148, -27.237744687970515, -18.102727120628977,
            -27.471975907645916, -53.56896551724127, -64.37959025898712,
            -92.10454669207708, -71.16798257555125, -77.15763680914758,
            -64.63381432071876, -93.60845495722175, -87.64469048817293,
            -92.29994967287354, -85.19705222685037, -90.90909090909098,
            -79.37304075235132, -80.46934140802432, -32.799145299145785,
            -29.220085470085575, -72.3824786324789, -14.10319410319411,
            -12.173086067522343, -64.0989063242988, -87.93427230046976,
            -91.49188761377135, -81.2821527502967, -68.38148001582898,
            -91.93706981317588, -91.68975069252063, -60.603262542320515,
            -91.9473361910594, -47.97917942437224, -32.210655235762374,
            -32.11879975505211, -66.2584200857318, -77.56669361358144,
            -83.83185125303153, -75.46483427647561, -59.700889248180985,
            -70.21018593371058, -77.97089733225575, -68.6742118027486,
            -56.58852061438963, -55.133387227162416, -46.179822710004345,
            -33.09413254537785, -21.823554242296584, -33.22429906542013,
            -10.934579439251966, -9.519533004041339, -10.29684601113135,
            -11.496844003606673, -16.05049594229014, -26.19477006311974,
            -20.757575757575875, -79.16188289322615, -73.85740402193801,
            -66.54478976233992, -61.54783668494777, -90.03656307129769,
            -94.63986599664979, -95.44835635090443, -94.94931531211091,
            -95.18050862528892, -92.05050684687885, -96.26606460576593,
            -91.51109545614645, -95.68283453732373, -94.47783621337331,
            -96.13314447592064, -95.89235127478757, -96.84678791050638,
            -91.85872493265498, -94.39467034229254, -95.4657873042046,
            -95.83776124690043, -92.80906836698539, -96.07076033339013,
            -86.48934296283254
        ]

    def test_wpr(self):
        period = 14
        wpr = williams_percent_r.williams_percent_r(self.high_data, self.low_data, self.close_data, period)
        print (wpr.tolist())
        np.testing.assert_array_equal(wpr, self.wpr_expected)
